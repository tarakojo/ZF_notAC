\documentclass{report}

\usepackage{graphicx} 
\usepackage{luacode}  
\usepackage{ascmac}
\usepackage{comment}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{xcolor}

\usepackage{mdframed}
% isabelleコードの枠
\newenvironment{isaframe}{\begin{mdframed}[topline=false, rightline=false, bottomline=false]}{\end{mdframed}}

\usepackage{fontspec}
% コード用フォントはとりあえずこれで
% 等幅じゃないけど見やすい
\setmonofont{TeXGyreDejaVuMath-Regular}[Scale=0.75]

% fontspecは先にしないとエラーが出る
\usepackage{newtxtext,newtxmath}

% 参考文献
\usepackage[style=numeric,backend=biber]{biblatex}
\addbibresource{main.bib}

% URL
\usepackage{hyperref}
\hypersetup{luatex, pdfencoding=auto}

% コード表示
\usepackage[outputdir=out]{minted} 

% 定理
\newtheorem{thm}{Theorem}[section]
\newtheorem{lem}[thm]{Lemma}
\newtheorem{dfn}[thm]{Definition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{prop}[thm]{Proposition}
 
\begin{document}

\title{MyTitle}
\author{MyName}
\date{\today}
\maketitle


\clearpage
\tableofcontents
\clearpage
\chapter{Introduction}

The formalization of mathematics using proof assistants such as Isabelle, Coq, and Lean, has been actively conducted, leading to numerous achievements. 
For instance, the proofs of the four color theorem, Kepler's conjecture, and the Feit-Thompson theorem have been formalized using proof assistants, enhancing the reliability of these proofs. 
Additionally, various fields of mathematics, such as number theory, algebra, and topology, are also being formalized.

The independence of the axiom of choice(AC) from Zermelo-Fraenkel set theory(ZF) is a well-known result in the early history of axiomatic set theory,
as well as the independence of the continuum hypothesis(CH) from ZF with AC(ZFC).
Cohen invented the forcing method and proved them in 1963.
Forcing is a powerful tool for exploring models of set theory and was subsequently further sophisticated by other researchers.

Independence proofs of CH from ZFC has been formalized in Isabelle/ZF by Gunther et al. \cite{gunther_independence} and in Lean 3 by Han and van Doorn \cite{flypitch}.
In these studies, forcing methods were formalized, and the independence of CH was proven by 
showing the relative consistency of CH and $\neg$CH with ZFC.

For AC, the relative consistency of AC with ZF has been formalized in Isabelle/ZF by Paulson \cite{paulson_AC_consistency}.
However, the relative consistency of $\neg$AC with ZF has not been formalized.
It can be proven by forcing, but the proof involves complexities that cannot be achieved by simply modifying the proof for CH.

In this work, we formalized the relative consistency proof of $\neg$AC with ZF in Isabelle/ZF. 
This work contributes to the formalization of axiomatic set theory and 
serves as a new example of the formalization using forcing, which is a crucial tool in set theory.
It also may provide insights into how the formalization of axiomatic set theory could be advanced.


\subsubsection{Our Approach}
The primary reason we chose Isabelle/ZF for this formalization is that Isabelle/ZF is a mature proof assistant for ZF set theory,
in particular, the formalization by Gunther et al. \cite{gunther_forcing} is a major advantage for this study.
Although there is also a formalization of forcing in Lean 3 by Han and van Doorn \cite{flypitch}, development for Lean 3 has already ended.

To use Gunther et al.'s formalization, we adopted the c.t.m.\  approach for our proof, as in their independence proof of CH.
Specifically, we assumed the existence of a c.t.m.\  of ZF and constructed a model of ZF + $\neg$AC by forcing.
This model is known as the basic Cohen model, which is a symmetric extension of assumed c.t.m.\ 
Our proof largely follows karagila's lecture note \cite{karagila}, with some parts also referencing Jech's books \cite{jech_set_theory,jech_AC}
as these resources align well with this approach.

The c.t.m.\  approach is a well-established method for relative consistency proofs in axiomatic set theory.
The relative consistency of $\neg$AC with ZF means that if ZF is consistent, then ZF + $\neg$AC is also consistent.
Assuming the consistency of ZF implies that a model of ZF exists, but strictly speaking, the existence of a c.t.m.\  cannot be derived from this assumption in ZF.
However, as explained in section \ref{subsection:ctm}, we can prove the relative consistency of $\neg$AC with ZF if 
we can construct a model of ZF + $\neg$AC from a c.t.m.\  of ZF.
This kind of reasoning always arises in the c.t.m.\  approach, and ideally, 
we would like to formalize it as well, but this has not been achieved.




\subsubsection{Related works}
Paulson et al. formalized an extensive part of ZF set theory 
\cite{paulson_datatype_impl,paulson_reflection,paulson_AC_consistency,paulson_cardinal_AC,paulson_datatype}
, including cardinal arithmetic, relativization, the reflection theorem, features for handling inductive definitions, and the relative consistency of AC with ZF.
The proof of the relative consistency was achieved by constructing constructing Gödel's constructible universe.

Building on these results, Gunther et al. formalized forcing and a proof of the independence of CH \cite{gunther_forcing,gunther_independence} in Isabelle/ZF.
In these formalizations, the countable transitive model (c.t.m.) approach was used, following Kunen's book \cite{kunen2011}.

In Lean, Han and van Doorn also formalized forcing and the independence of CH \cite{flypitch} in Lean 3.
using the Boolean-valued model approach, which is another approach to forcing.
Additionally, in Lean 4, Holmes and Wilshaw formalized the complex parts of the consistency proof of Quine's New Foundations \cite{NF_consistency}, ensuring the correctness of the proof.



\begin{comment}
  section2-...で説明するように、c.t.m.\ の存在はconzfからは導けないが、正当性が言えるのです
\end{comment}

\subsubsection{Repository}
Our source code is available at: \url{https://github.com/tarakojo/ZF_notAC}

\chapter{Preliminaries}
\section{Set-Theoretic Preliminaries}
In this section, we introduce the concepts of set theory used in the formalization of this study.
Our meta-theory is ZF, within which we explore ZF itself. 
Basically, our definition and theorems combine Kunen\cite{kunen2011}, karagila's lecture note\cite{karagila}, and Jech's book\cite{jech_AC}
adapted to the formalized form in Isabelle/ZF.


\subsection{ZF Set Theory and the Axiom of Choice}
We introduce the axioms of ZF set theory and the axiom of choice(AC).
We use first-order logic with the language of set theory, which consists only of only two relation symbols $\in$ and $=$. 
Formulas involving other mathmatical operators that may appear are considered abbreviations for formulas in this language.
Parentheses in formulas are omitted where no confusion arises.

\begin{dfn}
  The axioms of ZF are the following statements:
  \begin{itemize}
    \item Extensionality: $\forall x \forall y (\forall z (z \in x \leftrightarrow z \in y) \rightarrow x = y)$
    \item Pairing: $\forall x \forall y \exists z \forall w (w \in z \leftrightarrow w = x \lor w = y)$
    \item Union: $\forall x \exists y \forall z (z \in y \leftrightarrow \exists w (z \in w \land w \in x))$
    \item Power set: $\forall x \exists y \forall z (z \in y \leftrightarrow z \subseteq x)$
    \item Infinity: $\exists x (\emptyset \in x \land \forall y (y \in x \rightarrow y \cup \{y\} \in x))$
    \item Regularity: $\forall x(x \neq \emptyset \rightarrow \exists y (y \in x \land y \cap x = \emptyset))$
    \item Infinity: $\forall x (x \neq \emptyset \rightarrow \exists y (y \in x \land \forall z (z \in x \rightarrow z \notin y)))$
    \item Separation: $\forall p \forall x \exists y \forall z (z \in y \leftrightarrow z \in x \land \phi(z, p))$
    \item Replacement: $\forall p (\forall x \forall y \forall z (\phi(x, y, p) \land \phi(x, z, p) \rightarrow y = z) \rightarrow \\ \forall X \exists Y \forall y (y \in Y \leftrightarrow \exists x (x \in X \land \phi(x, y, p))))$
  \end{itemize}
\end{dfn}
Where separation and replacement are axiom schemas, representing infinitely many axioms for each formula $\phi$ with an appropriate arity.
\begin{dfn} 
  \emph{The axiom of choice (AC)} is the following statement: \\
  $\forall x \exists f (\mathrm{"} f \mathrm{ is a function on } x \mathrm{"} \land \forall y (y \in x \rightarrow f(y) \in y))$
\end{dfn}
Where the phrase "f is a function on x" is also considered an abbreviation in the language of set theory.
Theory ZF + AC is denoted by ZFC.
Additionally, we introduce the well-ordering theorem, as we treat AC in this form.

\begin{dfn}
  We say that a linear ordering $<$ on a set $P$ is a \emph{well-ordering} if, every non-empty subset of $P$, it has a least element.
\end{dfn}

\begin{lem}
  The axiom of choice is equivalent to the well-ordering theorem, which states that every set can be well-ordered.
\end{lem}

\subsection{Forcing}
Forcing is a tequnique used in proving relative consistency and Independence.
We introduce basic concepts of forcing in the context of the c.t.m.\  approach.
In this approach, the relative consistency proof is achieved by using forcing to construct a extended model by adding new sets to an assumed c.t.m.\ 
Let $M$ be a c.t.m.\  of ZF and $(\mathbb{P}, \leq_{\mathbb{P}})$ be a notion of forcing, which is a pre-ordered set in $M$ with a maximum element $1_{\mathbb{P}}$.

\begin{dfn}
  We define $M^{\mathbb{P}}$, the set of \emph{$\mathbb{P}$-names}, by transfinite recursion on ordinals:
  \begin{enumerate}
    \item $M^{\mathbb{P}}_0 = \emptyset$
    \item $M^{\mathbb{P}}_{\alpha + 1} = \mathcal{P}^M(M^{\mathbb{P}}_{\alpha} \times \mathbb{P})$
    \item $M^{\mathbb{P}}_{\alpha} = \bigcup_{\beta < \alpha} M^{\mathbb{P}}_{\beta}$ for a limit ordinal $\alpha$
    \item $M^{\mathbb{P}} = \bigcup_{\alpha \in \mathrm{Ord}} M^{\mathbb{P}}_{\alpha}$
  \end{enumerate}
\end{dfn}
Where $\mathcal{P}^M$ denotes the power set operation in $M$. 
We often write a $\mathbb{P}$-name with a dot, e.g., $\dot{x}$.
The least $\alpha$ such that $\dot{x} \in M^{\mathbb{P}}_{\alpha + 1}$ is called the \emph{$\mathbb{P}$-rank} of $\dot{x}$.
This allows us to define functions and relations by recursion on $\mathbb{P}$-names.

\begin{dfn}  
  \,
  \begin{enumerate}
    \item We say that $D \subseteq \mathbb{P}$ is \emph{dense} if, for every $p \in \mathbb{P}$, there exists $q \in D$ such that $q \leq_{\mathbb{P}} p$.
    \item We say that $G \subseteq \mathbb{P}$ is a \emph{filter} if following conditions hold:
      \begin{itemize}
        \item If $p \in G$, $q \in \mathbb{P}$, and $p \leq_{\mathbb{P}} q$, then $q \in G$
        \item If $p, q \in G$, there exists $r \in G$ such that $r \leq_{\mathbb{P}} p$ and $r \leq_{\mathbb{P}} q$
      \end{itemize}
    \item We say that $G \subseteq$ is \emph{generic filter} on $\mathbb{P}$ if $G$ is a filter and for any dense $D \subseteq \mathbb{P}$, $D \cap G \neq \emptyset$.
  \end{enumerate}
\end{dfn}

The following lemma shows that a generic filter actually exists.
\begin{lem} 
  For any $p \in \mathbb{P}$, there exists a generic filter $G$ on $\mathbb{P}$ such that $p \in G$.
\end{lem}

\begin{dfn} 
  Let $G$ be a generic filter on $\mathbb{P}$ and $\dot{x} \in M^{\mathbb{P}}$. We define the \emph{interpretation} of $\dot{x}$ denoted by $\dot{x}^G$ recursively with respect to the $\mathbb{P}$-rank of $\dot{x}$:
  $$\dot{x}^G = \{\dot{y}^G \mid \exists p \in G (\langle \dot{y}, p \rangle \in \dot{x})\}$$ 
\end{dfn}

We call a $\mathbb{P}$-name whose interpretation is a set $x$ a name of $x$ and denote it by $\dot{x}$.
Note that a single set may have multiple names.

\begin{dfn} 
  Let $G$ be a generic filter on $\mathbb{P}$. We define a \emph{generic extension} $M[G]$ as $\{x^G \mid \dot{x} \in M^{\mathbb{P}}\}$.
\end{dfn}

\begin{thm} 
  Let $G$ be a generic filter on $\mathbb{P}$. Then, $M[G]$ is the smallest c.t.m.\  of ZF extending $M$ and containing $G$.
\end{thm}

By choosing $\mathbb{P}$ appropriately, we can construct $M[G]$ with various properties.
What holds or does not hold in $M[G]$ can be identified using the forcing relation.
The forcing relation is defined recursively on formulas in a forcing language.
The forcing language is an extension of tha language of set theory by adding the elements of $M^{\mathbb{P}}$ as constants.
\begin{dfn} \label{dfn:forcing_relation}
  We define the \emph{forcing relation} $\Vdash$ for formulas in the forcing language and $p \in \mathbb{P}$ inductively
  \footnote{
    Specifically, the forcing relation is first defined for atomic formulas $\dot{x} = \dot{y}$ and $\dot{x} \in \dot{y}$ by mutual recursion,
    inductively on the $\mathbb{P}$-rank of $\dot{x}$ and $\dot{y}$.
    Then, the definition is extended to all formulas in the forcing language by induction on the complexity of formulas.
  }
  as follows:
  \begin{enumerate}
    \item $p \Vdash \dot{x} = \dot{y} \Leftrightarrow \forall \dot{z} \in \mathrm{dom}(\dot{x}) \cup \mathrm{dom}(\dot{y})\,
\forall q \leq_{\mathbb{P}} p \, (q \Vdash \dot{z} \in \dot{x} \leftrightarrow q \Vdash \dot{z} \in \dot{y})$
    \item $p \Vdash \dot{x} \in \dot{y} \Leftrightarrow \forall q \leq_{\mathbb{P}} p\, \exists r \leq_{\mathbb{P}} q \, 
    \exists s \in \mathbb{P} \, \exists \dot{z} \in M^{\mathbb{P}} \, (\langle \dot{z}, s \rangle \in \dot{y} \land r \leq_{\mathbb{P}} s \land r \Vdash \dot{x} = \dot{z} )$
    \item $p \Vdash \phi \land \psi \Leftrightarrow p \Vdash \phi \land p \Vdash \psi$
    \item $p \Vdash \neg \phi \Leftrightarrow \forall q \leq_{\mathbb{P}} p \, \neg (q \Vdash \phi)$
    \item $p \Vdash \exists x \phi(x) \Leftrightarrow \forall q \leq_{\mathbb{P}} p \, \exists r \leq_{\mathbb{P}} q \, \exists \dot{x} \in M^{\mathbb{P}} \, (r \Vdash \phi(\dot{x}))$
  \end{enumerate}
\end{dfn}

\begin{thm}[The Truth Lemma] \label{thm:truth_lemma}
  Let $G$ be a generic filter on $\mathbb{P}$, $\varphi$ be a formula, and $\dot{x} \in M^{\mathbb{P}}$, then 
  $$M[G] \vDash \varphi(\dot{x}^G) \Leftrightarrow \exists p \in G \, (p \Vdash \varphi(\dot{x}))$$
\end{thm}

\begin{cor}
  Let $p \in \mathbb{P}$, $\varphi$ be a formula and $\dot{x} \in M^{\mathbb{P}}$, then
  $$p \Vdash \varphi(\dot{x}) \Leftrightarrow \text{for any generic filter } G \text{ containing } p, M[G] \vDash \varphi(\dot{x}^G)$$
\end{cor}

\subsection{Symmetric Extensions}\label{subsection:symmetrc_extensions}
Symmetric extensions are substructures of generic extensions of a given c.t.m.\  of ZF 
and are formed by interpreting only the hereditarily symmetric names.
Let $M$ be a c.t.m.\  of ZF, $(\mathbb{P}, \leq_{\mathbb{P}})$ be a pre-ordered set in $M$ with the maximum element $1_{\mathbb{P}}$.

\begin{dfn} \label{dfn:automorphism}
  We say that $\pi : \mathbb{P} \rightarrow \mathbb{P}$ is an \emph{automorphism} if for all $p, q \in \mathbb{P}$, $p \leq_{\mathbb{P}} q \Leftrightarrow \pi p \leq_{\mathbb{P}} \pi q$.
  $\pi$ induces an bijection on $\mathbb{P}$-names defined recursively as follows:
  $$ \pi \dot{x} = \{ \langle \pi \dot{y}, \pi p \rangle \mid \langle \dot{y}, p \rangle \in \dot{x} \} $$
\end{dfn}

\begin{dfn} 
  Let $\mathcal{G}$ be a group of automorphisms of $\mathbb{P}$. We say that $\mathcal{F}$ is a \emph{normal filter} on $\mathcal{G}$ if the following conditions hold:
  \begin{enumerate}
    \item $\mathcal{F}$ is non-empty family of subgroups of $\mathcal{G}$.
    \item $\mathcal{F}$ is closed under finite intersections and supergroups.
    \item For every $H \in \mathcal{F}$ and $\pi \in \mathcal{G}$, $\pi H \pi^{-1} \in \mathcal{F}$.
  \end{enumerate}
\end{dfn}

We fix a group of automorphisms $\mathcal{G}$ of $\mathbb{P}$ and a normal filter $\mathcal{F}$ on $\mathcal{G}$.
\begin{dfn} 
  For every $\mathbb{P}$-name $\dot{x}$, let $\mathrm{sym}(\dot{x}) = \{ \pi \in \mathcal{G} \mid \pi \dot{x} = \dot{x} \}$.
  We say that $\mathbb{P}$-name $\dot{x}$ is \emph{symmetric} if $\mathrm{sym}(\dot{x}) \in \mathcal{F}$.
\end{dfn}

\begin{dfn} \label{dfn:hereditarily_symmetric}
  We define the set of all hereditarily symmetric names $\mathrm{HS}$ recursively as follows:
  \begin{enumerate}
    \item $0 \in \mathrm{HS}$
    \item if $\mathrm{dom}(\dot{x}) \subseteq \mathrm{HS}$ and $\dot{x}$ is symmetric, then $\dot{x} \in \mathrm{HS}$
  \end{enumerate}
\end{dfn}

\begin{dfn} 
  Let $G$ be a generic filter on $\mathbb{P}$. The set $\mathrm{HS}^{G} = \{ \dot{x}^G \mid \dot{x} \in \mathrm{HS} \}$ is called a \emph{symmetric extension} of $M$.
\end{dfn}

\begin{thm}
  Let $G$ be a generic filter on $\mathbb{P}$. Then, the symmetric extension $\mathrm{HS}^{G}$ is a c.t.m.\  of ZF and a substructure of $M[G]$.
\end{thm}

\begin{dfn}
  The relativized forcing relation $\Vdash_{\mathrm{HS}}$ is defined as the forcing relation $\Vdash$ with $M^{\mathbb{P}}$ in its definition replaced by $\mathrm{HS}$.
\end{dfn}

The relation $\Vdash_{\mathrm{HS}}$ acts as the forcing relation for symmetric extensions.

\begin{thm}\label{thm:symmetry_truth_lemma}
  Let $G$ be a generic filter on $\mathbb{P}$, $\mathcal{N}$ be a symmetric extension generated by $G$, $\varphi$ be a formula, and $\dot{x} \in \mathrm{HS}$, then
  $$\mathcal{N} \vDash \varphi(\dot{x}) \Leftrightarrow \exists p \in G \, (p \Vdash_{\mathrm{HS}} \varphi(\dot{x}))$$
\end{thm}

\begin{cor}\label{cor:symmetry_truth_lemma_cor}
  Let $p \in \mathbb{P}$, $\varphi$ be a formula, and $\dot{x} \in \mathrm{HS}$, then
  $$p \Vdash_{\mathrm{HS}} \varphi(\dot{x}) \Leftrightarrow \text{for any generic filter } G \text{ containing } p, \mathcal{N} \vDash \varphi(\dot{x}^G)$$
  Where $\mathcal{N}$ is the symmetric extension generated by $G$.
\end{cor}

The following lemmas also holds for the forcing relation $\Vdash$, but we only state them for $\Vdash_{\mathrm{HS}}$.

\begin{lem}\label{lem:strengthening}
  Let $p, q \in \mathbb{P}$, $\varphi$ be a formula. If $q \leq_{\mathbb{P}} p$ and $p \Vdash_{\mathrm{HS}} \varphi$, then $q \Vdash_{\mathrm{HS}} \varphi$.
\end{lem}

\begin{lem}[The Symmetry Lemma]\label{lem:symmetry_lemma}
  Let $\pi$ be an automorphism of $\mathbb{P}$, $\dot{x}_0, \ldots, \dot{x}_n \in \mathrm{HS}$, and $\varphi$ be a formula, then
  $$p \Vdash_{\mathrm{HS}} \varphi(\dot{x}_0, \ldots, \dot{x}_n) \Leftrightarrow \pi p \Vdash_{\mathrm{HS}} \varphi(\pi \dot{x}_0, \ldots, \pi \dot{x}_n)$$
\end{lem}

\subsection{The c.t.m.\  Approach}\label{subsection:ctm}

\section{Outline for the Informal Proof}\label{sec:outline}
We outline an informal proof of the relative consistency of $\neg$AC with ZF which we will formalize in the next chapter.
In this proof, the relative consistency is proved by assuming the existence of a c.t.m.\  of ZF and constructing a model of ZF + $\neg$AC by forcing. 
This model is a symmetric extension called the basic Cohen model.

Let $M$ be a c.t.m.\  of ZF, $\mathbb{P}$ be the set of all finite partial functions from $\omega \times \omega$ to $\{0, 1\}$, and $\leq_{\mathbb{P}}$ be $\supseteq$.
Note that the maximum element $1_{\mathbb{P}}$ is the empty set. 
Let $\pi$ be a bijection on $\omega$. $\pi$ induces an automorphism on $\mathbb{P}$ defined as follows:
$$\mathrm{dom}(\pi p) = \{ (\pi n, m) \mid (n, m) \in \mathrm{dom}(p) \}$$
$$(\pi p)(\pi n, m) = p(n, m)$$
This automorphism further induces an automorphism on $\mathbb{P}$-names. 
Let $\mathcal{G}$ be the group of all such automorphisms.
For every finite $e \subseteq \omega$, let 
$$\mathrm{fix}(e) = \{ \pi \in \mathcal{G} \mid \forall n \in e (\pi n = n) \}$$
Let $\mathcal{F}$ be the set of all subgroups $H$ of $\mathcal{G}$ such that there exists a finite $e \subseteq \omega$ with $\mathrm{fix}(e) \subseteq H$.
Note that $\mathcal{F}$ is a normal filter on $\mathcal{G}$. Let $\mathcal{N} = \mathrm{HS}^{G}$.
Since $\mathcal{N}$ is a symmetric extension of $M$, it is a c.t.m.\  of ZF. 

\begin{thm}
  $\mathcal{N}$ does not satisfy the well-ordering theorem.
\end{thm}

\begin{proof}
We outline the proof of this theorem as follows. 
For every $n \in \omega$, let $a_n$ be the following real number (a subset of $\omega$):
$$a_n = \{ m \in \omega \mid \exists p \in G (p(n, m) = 1) \}$$
Since $a_n$ are pairwise distinct, $A = \{ a_n \mid n \in \omega \}$ is an infinity set.
$A$ and every $a_n$ are elements of $\mathcal{N}$.
$A$ serves as a counterexample to the well-ordering theorem in $\mathcal{N}$.
Suppose for contradiction that $A$ is well-ordered in $\mathcal{N}$, there exists a injection $f$ from $\omega$ to $A$ in $\mathcal{N}$.
Let $\varphi(g,x,y)$ be a formula that represents the relation $g(x) = y$. 
For every $n \in \omega$ with $a_n \in \mathrm{ran}(f)$, there exists $i \in \omega$ such that $N \vDash \varphi(f, i, a_n)$.
Thus there exists $p \in G$ and hereditarily symmetric names $\dot{f}, \dot{i}$ and $\dot{a_n}$ for each of $f, i, a_n$ such that 
$$p \Vdash_{\mathrm{HS}} \varphi(\dot{f}, \dot{i}, \dot{a_n})$$
By choosing $n$ and the names appropriately, we can find a bijection $\pi$ on $\omega$ such that the following conditions are additionally satisfied:
\begin{enumerate}
  \item $\pi \dot{f} = \dot{f}$
  \item $\pi \dot{i} = \dot{i}$
  \item $\pi n \ne n$
  \item There exists a hereditarily symmetric name $\dot{a_{\pi n}}$ of $a_{\pi n}$ such that $\pi \dot{a_n} = \dot{a_{\pi n}}$
  \item There exists $q \in G$ such that $q \leq_{\mathbb{P}} p$ and $q \leq_{\mathbb{P}} \pi p$
\end{enumerate}
Note that some occurence of $\pi$ in above conditions refer to the induced automorphism on $\mathbb{P}$ or $\mathbb{P}$-names..
By Lemma \ref{lem:symmetry_lemma}
$$\pi p \Vdash_{\mathrm{HS}} \varphi(\pi \dot{f}, \pi \dot{i}, \pi \dot{a_n})$$
Thus 
$$\pi p \Vdash_{\mathrm{HS}} \varphi(\dot{f}, \dot{i}, \dot{a_{\pi n}})$$
Therefore, by Lemma \ref{lem:strengthening}
$$q \Vdash_{\mathrm{HS}} \varphi(\dot{f}, \dot{i}, \dot{a_n}) \mathrm{ and } q \Vdash_{\mathrm{HS}} \varphi(\dot{f}, \dot{i}, \dot{a_{\pi n}})$$
This means that $\mathcal{N} \vDash \varphi(f, i, a_n)$ and $\mathcal{N} \vDash \varphi(f, i, a_{\pi n})$, which implies that $f(i) = a_n$ and $f(i) = a_{\pi n}$.
Since $a_n$ and $a_{\pi n}$ are distinct, this is a contradiction. 
\end{proof}
 
\section{Isabelle/ZF and Formalization in Prior Work}
In this section, we introduce Isabelle/ZF, a proof assistant for ZF set theory, 
and the results from prior work used in the formalization of this study.
\subsubsection{The locale \texttt{"forcing\_data"} by Gunther et al.}

\begin{comment}  

強制関係を説明する！

\section{Isabelle/ZF}
\section{Internalized First-Order Formulas}
\section{Forcing}  
\end{comment}

\chapter{Formalization of the Proof} 
In this chapter, we present the formalization of the relative consistency proof of $\neg$AC with ZF in Isabelle/ZF.
We follow the outline presented in section \ref{sec:outline}.
We choose \emph{ZF-Constructible} by Paulson \cite{paulson_AC_consistency} as Isabelle theory 
\footnote{Note that this does not mean assuming $V=L$.}
, which includes the ZF axioms along with useful definitions and lemmas built on top of them.
We also reuse the formalization of forcing by Gunther et al. \cite{gunther_forcing}.

\section{Defining Symmetric Extensions}
First, we define symmetric extensions in Isabelle/ZF,
formalizing automorphisms, normal filters, and hereditarily symmetric names.

\subsubsection{$\mathbb{P}$-names}
We begin our work within the locale \texttt{"forcing\_data"} by Gunther et al. \cite{gunther_forcing}, 
in which a c.t.m.\  \texttt{"M"} and a notion of forcing \texttt{"P"} are fixed.
The relation $\leq_{\mathbb{P}}$ is denoted by \texttt{"leq"} and 
a maximum element $1_{\mathbb{P}}$ is denoted by \texttt{"one"}.

Gunther et al. did not provide an excplicit formalization of the set of $\mathbb{P}$-names $M^{\mathbb{P}}$ in their work.
In this study, since we need to consider a subset of $M^{\mathbb{P}}$, we define $M^{\mathbb{P}}$ explicitly.
We define $M^{\mathbb{P}}_{\alpha}$ as \texttt{"P\_set(α)"} and $M^{\mathbb{P}}$ as \texttt{"P\_names"} as follows:

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
definition HP_set_succ :: "[i, i] ⇒ i" where 
    "HP_set_succ(a, X) ≡ Pow(X × P) ∩ M" 

definition P_set :: "i ⇒ i" where 
    "P_set(a) ≡ transrec2(a, 0, HP_set_succ)" 

definition P_names :: "i" where "P_names ≡ { x ∈ M . ∃ a. Ord(a) ∧ x ∈ P_set(a) }" 
\end{minted}
\end{isaframe} 

Where \texttt{"transrec2(α, x, H)"} is the function defined in \emph{ZF} library
that returns \texttt{x} when \texttt{α} is 0;
when \texttt{α} is a successor ordinal, it returns \texttt{H(β, transrec2(β, x, H))} where \texttt{β} is the predecessor of \texttt{α};
and when \texttt{α} is a limit ordinal, it returns $\bigcup$\texttt{β∈α. transrec2(β, x, H)}.
Note that in Isabelle/ZF, the notation \texttt{"\{ x ∈ A. P(x) \}"} denotes
the set of elements in \texttt{A} that satisfy the predicate \texttt{P}.

\subsubsection{Automorphisms}
To simplify the formalization, we declare and work within the locale \texttt{"forcing\_data\_partial"}, 
where $\mathbb{P}$ is assumed to be a partially ordered set. 
Note that \texttt{"one"} is the unique maximum element of $\mathbb{P}$ in this locale.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
locale forcing_data_partial = forcing_data + 
    assumes leq_relation_on_P : "leq ∈ Pow(P × P)" 
    and leq_partial_order : "partial_order_on(P, leq)" 
\end{minted}
\end{isaframe}

We define the set of automorphisms on $\mathbb{P}$, denoted by \texttt{"P\_auto"}, as follows:
\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
definition is_P_auto :: "i ⇒ o" where
    "is_P_auto(π) ≡ π ∈ M ∧ π ∈ bij(P, P) ∧ (∀ p ∈ P. ∀q ∈ P. p ≼ q ⟷ π`p ≼ π`q)"  

definition P_auto where "P_auto ≡ { π ∈ P → P. is_P_auto(π) }" 
\end{minted}
\end{isaframe}

Where \texttt{"bij(A, B)"} is the set of bijections from \texttt{A} to \texttt{B}
and \texttt{"f`x"} denotes the function application of \texttt{f} to \texttt{x}.
We denote the induced automorphism on $\mathbb{P}$-names by \texttt{π} as \texttt{"Pn\_auto(π)"}.
Our definition of \texttt{"Pn\_auto"} satisfies the equality given in Definition \ref{dfn:automorphism}.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma Pn_auto : 
    "x ∈ P_names ⟹ Pn_auto(π)`x = { <Pn_auto(π)`y, π`p> . <y, p> ∈ x}"  
\end{minted}
\end{isaframe}


\subsubsection{Groups of Automorphisms and Normal Filters}
First, we define the set of all subgroups of a group of automorphisms \texttt{G} that are in \texttt{"M"}.
\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
  definition is_P_auto_group where 
      "is_P_auto_group(G) ≡ 
        G ⊆ { π ∈ P → P. is_P_auto(π) } 
      ∧ (∀π ∈ G. ∀τ ∈ G. π O τ ∈ G) 
      ∧ (∀π ∈ G. converse(π) ∈ G)"   
  
  definition P_auto_subgroups where 
      "P_auto_subgroups(G) ≡ { H ∈ Pow(G) ∩ M. is_P_auto_group(H) }" 
\end{minted}
\end{isaframe}
Where \texttt{"π O τ"} denotes the composition of \texttt{π} and \texttt{τ}.
Then, we declare a locale \texttt{"M\_symmetric\_system"} that fixes a group of automorphisms \texttt{"𝒢"} and a normal filter \texttt{"ℱ"} on \texttt{"𝒢"}.
\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
locale M_symmetric_system = forcing_data_partial + 
    fixes 𝒢 ℱ 
    assumes 𝒢_in_M : "𝒢 ∈ M"  
    and 𝒢_P_auto_group : "is_P_auto_group(𝒢)"   
    and ℱ_in_M : "ℱ ∈ M"
    and ℱ_subset : "ℱ ⊆ P_auto_subgroups(𝒢)" 
    and ℱ_nonempty : "ℱ ≠ 0" 
    and ℱ_closed_under_intersection : "∀A ∈ ℱ. ∀B ∈ ℱ. A ∩ B ∈ ℱ" 
    and ℱ_closed_under_supergroup : 
        "∀A ∈ ℱ. ∀B ∈ P_auto_subgroups(𝒢). A ⊆ B ⟶ B ∈ ℱ" 
    and ℱ_normal : "∀H ∈ ℱ. ∀π ∈ 𝒢. { π O τ O converse(π). τ ∈ H } ∈ ℱ" 
\end{minted}
\end{isaframe}

\subsubsection{Hereditarily Symmetric Names}
We continue our work within the locale \texttt{"M\_symmetric\_system"}.
We define the set of hereditarily symmetric names \texttt{"HS"} in the same way as \texttt{"P\_names"}.
This approach makes it easier to use induction based on the $\mathbb{P}$-rank of names.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
definition sym where "sym(x) ≡ { π ∈ 𝒢. Pn_auto(π)`x = x }"  

definition symmetric where "symmetric(x) ≡ sym(x) ∈ ℱ"  

definition HHS_set_succ where 
  "HHS_set_succ(a, X) ≡ { x ∈ P_set(succ(a)). domain(x) ⊆ X ∧ symmetric(x) }" 

definition HS_set where "HS_set(a) ≡ transrec2(a, 0, HHS_set_succ)"

definition HS where "HS ≡ { x ∈ P_names. ∃a. Ord(a) ∧ x ∈ HS_set(a) }" 
\end{minted}
\end{isaframe}

The following lemma shows our definition of \texttt{"HS"} is equivalent to Definition \ref{dfn:hereditarily_symmetric}.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma HS_iff: "x ∈ HS ⟷ x ∈ P_names ∧ domain(x) ⊆ HS ∧ symmetric(x)" 
\end{minted}
\end{isaframe}

\subsubsection{Symmetric Extensions}
Finally, we define symmetric extensions.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
definition SymExt where "SymExt(G) ≡ { val(G, x). x ∈ HS }" 
\end{minted}
\end{isaframe}

Where \texttt{"val(G, x)"} is the interpretation $x^G$ formalized by Gunther et al. \cite{gunther_forcing}.

We declare a locale \texttt{"M\_symmetric\_system\_G\_generic"},
which combines the locale \texttt{"M\_symmetric\_system"} and the locale \texttt{"G\_generic"}.
\texttt{"G\_generic"} is a locale, defined by Gunther et al. \cite{gunther_forcing}, fixes a generic filter \texttt{"G"} on \texttt{"P"}.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
locale M_symmetric_system_G_generic = M_symmetric_system + G_generic
\end{minted}
\end{isaframe}

The following lemmas can be proved relatively easily in this locale.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma M_subset_SymExt : "M ⊆ SymExt(G)" 
lemma SymExt_subset_GenExt : "SymExt(G) ⊆ GenExt(G)" 
lemma Transset_SymExt : "Transset(SymExt(G))" 
lemma SymExt_countable : "nat ≈ SymExt(G)" 
\end{minted}
\end{isaframe}

Where \texttt{"GenExt(G)"} is the generic extension generated by \texttt{"G"}, 
\texttt{"Transset(A)"} denotes that \texttt{"A"} is transitive, and
\texttt{"nat ≈ A"} denotes that \texttt{"A"} has the same cardinality as the set of natural numbers.

\subsubsection{Formulas Representing These Definitions}
In our proofs, we need to use the separation and replacement axioms in M
based on formulas that include the concepts defined in this section.
Therefore, it is necessary to represent these concepts as internalized formulas.

We utilized the automated formula synethisis method by Gunther et al. \cite{gunther_forcing};
however, it could not applied to complex formulas, 
and re-verifying the properties of the derived formulas in an accessible form remained a repititive task.

Example of the formulas we defined includes \texttt{"is\_P\_auto\_group"}, \texttt{"is\_P\_name\_fm"}, \texttt{"is\_Pn\_auto\_fm"}, and \texttt{"is\_HS\_fm"},
whick represent \texttt{"P\_names"}, \texttt{"Pn\_auto"} and \texttt{"HS"} respectively.
The correctness of these formulas is verified by proving the following lemmas. 

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma sats_is_P_name_fm_iff : 
    fixes env i j x 
    assumes "env ∈ list(M)" "i < length(env)" "j < length(env)" 
                    "nth(i, env) = P" "nth(j, env) = x"  
    shows "sats(M, is_P_name_fm(i, j), env) ⟷ x ∈ P_names" 

lemma sats_is_Pn_auto_fm_iff :
    fixes x π v env i j k l
    assumes "i < length(env)" "j < length(env)" "k < length(env)" "l < length(env)" 
                    "nth(i, env) = P" "nth(j, env) = π" "nth(k, env) = x" "nth(l, env) = v" 
                    "env ∈ list(M)" "π ∈ P_auto" 
    shows "sats(M, is_Pn_auto_fm(i, j, k, l), env) ⟷ x ∈ P_names ∧ v = Pn_auto(π)`x" 

lemma sats_is_HS_fm_iff : 
    fixes x i j env 
    assumes "env ∈ list(M)" "i < length(env)" "j < length(env)" 
                    "nth(i, env) = <ℱ, 𝒢, P, P_auto>" "nth(j, env) = x" 
    shows "sats(M, is_HS_fm(i, j), env) ⟷ x ∈ HS" 
\end{minted}
\end{isaframe}

Note that these formulas take as parameters various elements fixed within the locale, 
such as the notion of forcing \texttt{"P"}, the normal filter \texttt{"ℱ"}, etc.

\section{Proving Symmetric Extensions are Models of ZF}

In this section, we prove that symmetric extensions are models of ZF.
Initially, we attempted to prove this based on its proof in Karagila's lecture note \cite{karagila},
but this approach was unsuccessful.
Instead, we prove this by using the relativized forcing relation $\Vdash_{\mathrm{HS}}$.
Karagila's approach is applicable to a more general situation,
without using forcing or generic and symmetric extensions,
whereas our approach is more specific to the context of symmetric extensions.

\subsubsection{Unsuccessful Approach}

In Karagila's lecture note \cite{karagila},
the fact that symmetric extensions are models of ZF is proven by showing that 
they are internal models of the conrresponding generic extension
generated by the same notion of forcing and generic filter,
using the following proposition:

\begin{prop}
If $\mathcal{N}$ is a transitive class that is almost universal and satisfies $\Delta_0$-separation, 
then $\mathcal{N}$ is a inner model of ZF.
\end{prop}

Where a class $\mathcal{N}$ is said to be \emph{almost universal} 
\footnote{Jech \cite{jech_set_theory}, Theorem 13.9.}
if every subset $X \subseteq \mathcal{N}$ is included in some $Y \in \mathcal{N}$.
Furthermore, $\mathcal{N}$ is said to satisfy $\Delta_0$-separation if it satisfies the separation axioms for formulas with only bounded quantifiers.

We could prove that the symmetric extension \texttt{"SymExt(G)"} is transitive, almost universal and satisfies $\Delta_0$-separation.
However, we could not prove that \texttt{"SymExt(G)"} is actually a class in \texttt{"GenExt(G)"}.
To do this, we needed to explicitly construct a formula that represents the set of all names \texttt{"P\_names"} on the ground model \texttt{"M"} in \texttt{"GenExt(G)"}.
However, we were unable to construct such a formula.

\subsubsection{The Relativized Forcing Relation $\Vdash_{\mathrm{HS}}$}
Instead, we formalize the relativized forcing relation $\Vdash_{\mathrm{HS}}$ and prove that symmetric extensions are models of ZF using it.
This relation is defined by replacing all quantifiers restricted to $M^{\mathbb{P}}$
in the definition of the forcing relation with quantifiers restricted to $\mathrm{HS}$.
By modifying the formalization of forcing by Gunther et al. \cite{gunther_forcing}
\footnote{For non-atomic formulas, the definition of the forcing relation by Gunther et al. \cite{gunther_forcing} 
actually differs from Definition \ref{dfn:forcing_relation}.
In their definition, the unique logical connective is NAND, and the unique quantifier is $\forall$.
Additionally, in the definition, quantifiers restricted to $M$ appear instead of those restricted to $M^{\mathbb{P}}$.}
, we were able to define this relation and prove its properties relatively easily.

Within the locale \texttt{"M\_symmetric\_system"},
we define this relation in the form \texttt{"p ⊩HS φ env"},
which has the same form as the formalization of the original forcing relation \texttt{"p ⊩ φ env"} by Gunther et al.
Our definition satisfies the required properties, such as Theorem \ref{thm:symmetry_truth_lemma}, Corollary \ref{cor:symmetry_truth_lemma_cor}, and Lemma \ref{lem:strengthening}.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma HS_truth_lemma:
    assumes 
        "φ∈formula" "M_generic(G)"
    shows 
        "⋀env. env∈list(HS) ⟹ arity(φ)≤length(env) ⟹ 
              (∃p∈G. p ⊩HS φ env) ⟷ SymExt(G), map(val(G),env) ⊨ φ"

lemma definition_of_forcing_HS:
    assumes
        "p∈P" "φ∈formula" "env∈list(HS)" "arity(φ)≤length(env)"
    shows
        "(p ⊩HS φ env) ⟷
              (∀G. M_generic(G) ∧ p∈G  ⟶  SymExt(G), map(val(G),env) ⊨ φ)"

lemma HS_strengthening_lemma:
    assumes 
        "p∈P" "φ∈formula" "r∈P" "r≼p"
    shows
        "⋀env. env∈list(M) ⟹ arity(φ)≤length(env) ⟹ p ⊩HS φ env ⟹ r ⊩HS φ env"
\end{minted}
\end{isaframe}

\subsubsection{The Symmetry Lemma}
Additionally, we prove the symmetry lemma (Lemma \ref{lem:symmetry_lemma}).
Similary to the definitions of the forcing relations, this lemma is proven using a complex induction.
First, we prove this lemma for atomic formulas in the forcing language, 
and then extend the proof to other formulas by structual induction on the formula.
For atomic formulas $\dot{x} = \dot{y}$ and $\dot{x} \in \dot{y}$, 
the definition is mutually recursive, so the lemma for these formulas is proven simultaneously
by induction on the $\mathbb{P}$-rank of $\dot{x}$ and $\dot{y}$.
Specifically, we show these induction steps:

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
  have MEM_step: "⋀a. Ord(a) ⟹ ∀b ∈ a. Q(EQ, b, b) ⟹ ∀b ∈ a. Q(MEM, b, a)"  
  have EQ_step : "⋀a. Ord(a) ⟹ ∀b ∈ a. Q(MEM, b, a) ⟹ Q(EQ, a, a)"   
\end{minted}
\end{isaframe}

Where \texttt{"Q(MEM, α, β)"} and \texttt{"Q(EQ, α, β)"} are predicates 
representing that the symmetriy lemma holds for $\dot{x} \in \dot{y}$ and $\dot{x} = \dot{y}$, respectively,
for any $\dot{x}$ with $\mathbb{P}$-rank at most $\alpha$ and $\dot{y}$ with $\mathbb{P}$-rank at most $\beta$.

The proof for non-atomic formulas is relatively straightforward, and finally, 
this completes the proof of the lemma.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma symmetry_lemma:
    fixes φ π  
    assumes "φ ∈ formula" "is_P_auto(π)" "π ∈ 𝒢" 
    shows "⋀env p. env ∈ list(HS) ⟹ arity(φ) ≤ length(env) ⟹ p ∈ P ⟹ 
                p ⊩HS φ env ⟷ π`p ⊩HS φ map(λx. Pn_auto(π)`x, env)" 
\end{minted}
\end{isaframe}

\subsubsection{Separation}
Using the symmetry lemma, we prove the axiom schema of separation for symmetric extensions 
within the locale \texttt{"M\_symmetric\_system\_G\_generic"}.
Our proof is based on Karagila's proof \cite{karagila} of $\Delta_0$-separation for symmetric extensions.
However, since we use the $\Vdash_{\mathrm{HS}}$ relation instead of $\Vdash$,
we can prove separation for any formula, not just $\Delta_0$ formulas.

The separation for the formula $\varphi$ means that 
for any elements $x, p$ in the symmetric extension, the set $X = \{ y \in x \mid \varphi(y, p) \}$ is also an element of it.
To prove this, we show that 
$\dot{X} = \{ \langle y, p \rangle \in \mathrm{dom}(x) \times \mathbb{P} \mid p \Vdash_{\mathrm{HS}} \varphi(\dot{y}, \dot{p}) \}$ is a hereditarily symmetric name of $X$,
i.e., $\dot{X} \in \mathrm{HS}$ and $\dot{X}^G = X$.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma sep_forces_pair_in_HS : 
    fixes x env φ
    assumes "x ∈ HS" "env ∈ list(HS)" "φ ∈ formula" "arity(φ) ≤ succ(length(env))" 
    shows "{ <y, p> ∈ domain(x) × P. p ⊩HS φ [y] @ env } ∈ HS"

lemma SymExt_separation : 
    fixes x env φ 
    assumes "x ∈ SymExt(G)" "env ∈ list(SymExt(G))" 
                    "φ ∈ formula" "arity(φ) ≤ succ(length(env))" 
    shows "{ y ∈ x. sats(SymExt(G), φ, [y] @ env) } ∈ SymExt(G)"
\end{minted}
\end{isaframe}

\subsubsection{Replacement}
Now that we have proven separation, to prove the axiom schema of replacement for symmetric extensions,
it is sufficient to show that for any formula $\varphi$ and any elements $x, p$ in a symmetric extension $\mathcal{N}$,
we can find a set $S \in \mathcal{N}$ such that : 
$$\mathcal{N} \vDash \exists z \, \varphi(y, z, p) \text{ iff }
  \mathcal{N} \vDash \exists z \, (z \in S \land \varphi(y, z, p)) \text{ for all } y \in x$$
This is because such a set $S$ contains the image of $x$ under the class function defined by $\varphi$ \footnote{If $\varphi$ defines a class function.},
which is the set that would be obtained by applying the replacement axiom.
To prove this, we show the following lemma, which rewrites the above statement in terms of the forcing relation $\Vdash_{\mathrm{HS}}$,
and then prove it.
\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma ex_hs_subset_contains_witnesses : 
    fixes φ env x 
    assumes "φ ∈ formula" "env ∈ list(M)" "arity(φ) ≤ 2 #+ length(env)" "x ∈ M" 
    shows "∃S. S ∈ M ∧ S ⊆ HS ∧ (∀p ∈ G. ∀y ∈ domain(x). 
                (∃z ∈ HS. p ⊩HS φ ([y, z] @ env)) ⟷ (∃z ∈ S. p ⊩HS φ ([y, z] @ env)))" 

  lemma ex_SymExt_elem_contains_witnesses : 
    fixes φ env x 
    assumes "φ ∈ formula" "env ∈ list(SymExt(G))" 
                "arity(φ) ≤ 2 #+ length(env)" "x ∈ SymExt(G)" 
    shows "∃S ∈ SymExt(G). ∀y ∈ x. 
                ((∃z ∈ SymExt(G). sats(SymExt(G), φ, [y, z] @ env)) 
                ⟷ (∃z ∈ S. sats(SymExt(G), φ, [y, z] @ env)))"
\end{minted}
\end{isaframe}

Additionally, the following lemma was helpful in these proofs.
This is also frequently used in the proofs of the axioms.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma ex_separation_base : 
    fixes X 
    assumes "X ⊆ HS" "X ∈ M" 
    shows "∃S ∈ SymExt(G). { val(G, x). x ∈ X } ⊆ S" 
\end{minted}
\end{isaframe}
This lemma states that for any set of hereditarily symmetric names $X \in M$, 
there exists a set $S$ in the symmetric extension such that $X^G \subseteq S$.

Then, we prove the axiom schema of replacement for symmetric extensions.
\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma SymExt_replacement :
    fixes φ env
    assumes "φ ∈ formula" "arity(φ) ≤ 2 #+ length(env)" "env ∈ list(SymExt(G))" 
    shows 
          "strong_replacement(##SymExt(G), λx y. sats(SymExt(G), φ, [x, y] @ env))" 
\end{minted}
\end{isaframe}

\subsubsection{Other Axioms}
Other axioms of ZF can be proven relatively easily in symmetric extensions by using separation, replacement and the lemma \texttt{"ex\_separation\_base"}.
For example, the axiom of pairing can be proven as follows. 
Let a, b be elements of a symmetric extension $\mathcal{N}$.
Then, we can take hereditarily symmetric names $\dot{a}, \dot{b}$ of a, b, respectively.
By the lemma \texttt{"ex\_separation\_base"}, we can find a set $S$ in $\mathcal{N}$ such that $\{ \dot{a}, \dot{b} \}^G \subseteq S$.
In other words, $\{ a, b \} \subseteq S$. 
Then by the separation axiom, $\{ x \in S \mid x = a \lor x = b \} = \{ a, b \}$ is an element of $\mathcal{N}$.

Finally we obtain the following lemma, which states that symmetric extensions are models of ZF.
\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
theorem SymExt_sats_ZF : "SymExt(G) ⊨ ZF" 
\end{minted}
\end{isaframe}

Furthermore, since symmetric extensions are transitive, it can be shown that they are 
instances of the locale \texttt{"M\_ZF\_trans"}.
As a result, many results concerning ZF set theory formalized in this locale can now be applied to symmetric extensions.

\begin{isaframe}
\begin{minted}[breaklines]{isabelle}
lemma SymExt_M_ZF_trans : "M_ZF_trans(SymExt(G))"
\end{minted}
\end{isaframe}

\begin{comment}
\subsection{Relativized Forcing Relation $\Vdash_{\mathrm{HS}}$}
\subsection{The Symmetric Lemma}
\subsection{Separation}
\subsection{Replacement}
\subsection{Other Axioms}
\end{comment}

\section{Defining the Basic Cohen Model}
\begin{comment}
\subsection{The Notion of Forcing}
\subsection{The Group of Automorphisms}
\subsection{The Normal Filter}
\end{comment}

\section{Proving the Basic Cohen Model satisfies $\neg$AC}

\chapter{Conclusion and Future Work}

%  In axiomatic set theory, discussions often shift between meta-level and object-level considerations, 
%  such as considering models of set theory within set theory itself. 
%  This is one of the challenging aspects when formalizing axiomatic set theory. 
%  In this formalization as well, this part was complex. 

  
\subsubsection{Acknowledgements}

\printbibliography
\end{document}
 